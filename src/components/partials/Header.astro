---
const pathname = Astro.url.pathname;

const isHomePage = pathname === '/';
const isWritingPage = pathname.startsWith('/writing');
const isResumePage = pathname === '/resume';

const navLinks = [
  { href: '/', label: 'Home', isActive: isHomePage },
  { href: '/writing', label: 'Writing', isActive: isWritingPage },
  { href: '/resume', label: 'Resume', isActive: isResumePage },
];
---

<header class="fixed top-0 left-0 right-0 z-50 px-4 pt-4">
  <nav class="max-w-[720px] mx-auto">
    <!-- Nav Bar -->
    <div class="nav-bar flex items-center justify-between px-5 py-3 border border-border rounded-full">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group">
        <span class="w-2 h-2 rounded-full bg-accent group-hover:scale-125 transition-transform"></span>
        <span class="text-sm font-semibold tracking-wide text-headings uppercase">baz.sh</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden sm:flex items-center gap-1">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'nav-link',
              link.isActive && 'nav-link-active'
            ]}
          >
            {link.label}
          </a>
        ))}
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        aria-label="Open menu"
        class="sm:hidden flex items-center justify-center w-8 h-8"
      >
        <span id="hamburger" class="relative w-4 h-3 flex flex-col justify-between">
          <span class="hamburger-line block w-full h-[2px] bg-text-secondary rounded-full transition-all duration-300 origin-center"></span>
          <span class="hamburger-line block w-full h-[2px] bg-text-secondary rounded-full transition-all duration-300 origin-center"></span>
          <span class="hamburger-line block w-full h-[2px] bg-text-secondary rounded-full transition-all duration-300 origin-center"></span>
        </span>
      </button>
    </div>

    <!-- Mobile Menu Dropdown -->
    <div
      id="mobile-menu"
      class="sm:hidden hidden mt-3 mx-2 p-3 bg-bg-elevated/95 backdrop-blur-md border border-border rounded-2xl shadow-lg"
    >
      <nav class="flex flex-col gap-1">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class:list={[
              'py-3 px-5 text-base font-medium rounded-xl transition-colors',
              link.isActive 
                ? 'text-headings bg-white/10' 
                : 'text-text-muted hover:text-headings hover:bg-white/5'
            ]}
          >
            {link.label}
          </a>
        ))}
      </nav>
    </div>
  </nav>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburger = document.getElementById('hamburger');

  let isOpen = false;

  function toggleMenu(open: boolean) {
    isOpen = open;
    mobileMenu?.classList.toggle('hidden', !isOpen);
    hamburger?.classList.toggle('open', isOpen);
  }

  menuBtn?.addEventListener('click', () => toggleMenu(!isOpen));

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (isOpen && !menuBtn?.contains(e.target as Node) && !mobileMenu?.contains(e.target as Node)) {
      toggleMenu(false);
    }
  });

  // Close menu when clicking a link
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => toggleMenu(false));
  });
</script>

<style>
  #hamburger.open .hamburger-line:nth-child(1) {
    transform: translateY(5px) rotate(45deg);
  }
  
  #hamburger.open .hamburger-line:nth-child(2) {
    transform: scaleX(0);
    opacity: 0;
  }
  
  #hamburger.open .hamburger-line:nth-child(3) {
    transform: translateY(-5px) rotate(-45deg);
  }
</style>
