---
import { getEntry, getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/Container.astro';
import { DEFAULT_CONFIGURATION } from '@/lib/constants';
import WorkExperience from '@/components/ui/WorkExperience.astro';
import { sortJobsByDate } from '@/lib/utils';
import { Image } from 'astro:assets';

const entry = await getEntry('pages', 'resume');
const links = await getCollection('links');
const jobs = await getCollection('jobs');
const sortedJobs = sortJobsByDate(jobs);
---

<BaseLayout seo={entry.data.seo}>
  <Container as="article" class="py-12">
    <!-- Header -->
    <header class="mb-12">
      <div class="flex items-center gap-4 mb-6">
        <Image
          src={DEFAULT_CONFIGURATION.author.avatar}
          alt={DEFAULT_CONFIGURATION.author.name}
          width={64}
          height={64}
          class="rounded-full"
        />
        <div>
          <h1 class="text-2xl font-bold text-headings">{DEFAULT_CONFIGURATION.author.name}</h1>
          <p class="text-text-secondary">{DEFAULT_CONFIGURATION.author.headline}</p>
        </div>
      </div>
      {DEFAULT_CONFIGURATION.author.location && (
        <p class="text-sm text-text-muted">{DEFAULT_CONFIGURATION.author.location}</p>
      )}
    </header>

    <!-- Contact Section -->
    {links.length > 0 && (
      <section class="mb-12">
        <span class="label mb-6 block">Contact</span>
        <ul class="space-y-3">
          {links.map((link) => (
            <li class="flex items-center gap-6">
              <span class="text-text-muted text-sm w-24 shrink-0">{link.data.label}</span>
              <a
                href={link.data.url}
                target="_blank"
                rel="noopener noreferrer"
                class="text-headings font-medium hover:text-accent transition-colors"
              >
                {link.data.name}
              </a>
            </li>
          ))}
        </ul>
      </section>
    )}

    <!-- Work Experience Section -->
    {sortedJobs.length > 0 && (
      <section>
        <span class="label mb-6 block">Work Experience</span>
        <div class="space-y-8">
          {sortedJobs.map((job) => (
            <WorkExperience entry={job} />
          ))}
        </div>
      </section>
    )}
  </Container>
</BaseLayout>
